<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Formulário de Login</title>
</head>
<body>
    <div class="login-container">
        <h2>Login</h2>
        <div id="login-form">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button id="click">Entrar</button>
      </div>
    </div>
    <script>
            const btn = document.getElementById('click')
            


            // Função para criar um hash SHA-256
            async function sha256(message) {
                        const encoder = new TextEncoder();
                        const data = encoder.encode(message);
                        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                        const hashArray = Array.from(new Uint8Array(hashBuffer));
                        const hashHex = hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
                        return hashHex;
                  }
                  
            // Função para criptografar uma senha usando SHA-256
            async function encryptPassword(password) {
                  const hashedPassword = await sha256(password);
                  return hashedPassword;
            }

            function getSingleCookieData(cookieName) {
                  var cookieValue = getCookie(cookieName);

                  if (cookieValue) {
                        var parsedData = JSON.parse(cookieValue);
                        return parsedData;
                  } else {
                        console.log("O cookie não existe.");
                        return null;
                  }
            }

            function getCookie(name) {
                  var cookies = document.cookie.split("; ");

                  for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].split("=");
                        if (cookie[0] === name) {
                              return cookie[1];
                        }
                  }

                  return null;
            }

            function getCookieData(cookieName) {
                  var cookieValue = getCookie(cookieName);

                  if (cookieValue) {
                        var parsedData = JSON.parse(cookieValue);
                        return parsedData;
                  } else {
                        console.log("O cookie não existe.");
                        return null;
                  }
                  }

                  function getCookie(name) {
                  var cookies = document.cookie.split("; ");

                  for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].split("=");
                        if (cookie[0] === name) {
                              return cookie[1];
                        }
                  }

                  return null;
            }

            

            btn.addEventListener('click', function(){
                  const email = document.getElementById("email").value;
                  const senha = document.getElementById("password").value;
                  var cookieData = getCookieData("dados");
                  var singleCookieData = getSingleCookieData("dados");
                  const senhaa = ''

                  // Exemplo de uso
                  encryptPassword(senha)
                        .then(hashedSenha => {
                              senhaa = hashedSenha
                  })
                  let loginCorreto = false

                  if (singleCookieData) {
                        var senha1 = singleCookieData.senha1;
                        var email1 = singleCookieData.email1;
                        if (senha1 == senhaa && email1 == email){
                                    loginCorreto = true
                        }
                  }

                  if (cookieData) {
                        for (var i = 0; i < cookieData.length; i++) {
                              var senha1 = cookieData[i].senha1;
                              var email1 = cookieData[i].email1;
                              
                              if (senha1 == senhaa && email1 == email){
                                    loginCorreto = true
                              }
                        }
                  }

                  if (loginCorreto){
                        alert('Login correto, acesso permitido!')
                  }else{
                        alert('Login incorreto!')
                  }

            })
            


    </script>
</body>
</html>
